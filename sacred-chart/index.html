<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="Sacred Chart">
  <meta name="theme-color" content="#115e59">
  <title>Scrubs Prediction Game - The Sacred Chart</title>
  
  <link rel="apple-touch-icon" href="icon-192.png">
  <link rel="manifest" href="manifest.json">
  
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  
  <style>
    body {
      margin: 0;
      padding: 0;
      overscroll-behavior: none;
    }
  </style>
</head>
<body>
  <div id="root"></div>
  
  <script type="text/babel">
    const { useState, useEffect } = React;

    function PredictionGame() {
      const [gameData, setGameData] = useState(null);
      const [loading, setLoading] = useState(true);
      const [currentSeason, setCurrentSeason] = useState(1);
      const [currentEpisode, setCurrentEpisode] = useState(1);

      const defaultData = {
        players: {
          jean: { name: 'Jean', totalPoints: 0 },
          ed: { name: 'Ed', totalPoints: 0 }
        },
        history: []
      };

      useEffect(() => {
        loadData();
      }, []);

      const loadData = () => {
        try {
          const saved = localStorage.getItem('sacred-chart-data');
          if (saved) {
            setGameData(JSON.parse(saved));
          } else {
            setGameData(defaultData);
          }
        } catch (e) {
          setGameData(defaultData);
        }
        setLoading(false);
      };

      const saveData = (newData) => {
        setGameData(newData);
        try {
          localStorage.setItem('sacred-chart-data', JSON.stringify(newData));
        } catch (e) {
          console.error('Failed to save:', e);
        }
      };

      const awardPoint = (predictor, correct) => {
        const winner = correct ? predictor : (predictor === 'jean' ? 'ed' : 'jean');
        const newData = {
          ...gameData,
          players: {
            ...gameData.players,
            [winner]: {
              ...gameData.players[winner],
              totalPoints: gameData.players[winner].totalPoints + 1
            }
          },
          history: [
            {
              season: currentSeason,
              episode: currentEpisode,
              predictor: gameData.players[predictor].name,
              correct,
              winner: gameData.players[winner].name,
              timestamp: new Date().toISOString()
            },
            ...gameData.history
          ]
        };
        saveData(newData);
      };

      const resetGame = () => {
        if (confirm('Reset all scores and history?')) {
          saveData(defaultData);
          setCurrentSeason(1);
          setCurrentEpisode(1);
        }
      };

      if (loading) {
        return (
          <div className="min-h-screen bg-teal-900 flex items-center justify-center">
            <div className="text-white text-xl">Loading...</div>
          </div>
        );
      }

      const jeanPoints = gameData.players.jean.totalPoints;
      const edPoints = gameData.players.ed.totalPoints;
      const leader = jeanPoints > edPoints ? 'Jean' : edPoints > jeanPoints ? 'Ed' : 'Tied';

      // Episode scores
      const episodeEntries = gameData.history.filter(h => h.season === currentSeason && h.episode === currentEpisode);
      const jeanEpisodePts = episodeEntries.filter(h => h.winner === 'Jean').length;
      const edEpisodePts = episodeEntries.filter(h => h.winner === 'Ed').length;
      const episodeLeader = jeanEpisodePts > edEpisodePts ? 'Jean' : edEpisodePts > jeanEpisodePts ? 'Ed' : 'Tied';

      // Season scores
      const seasonEntries = gameData.history.filter(h => h.season === currentSeason);
      const jeanSeasonPts = seasonEntries.filter(h => h.winner === 'Jean').length;
      const edSeasonPts = seasonEntries.filter(h => h.winner === 'Ed').length;
      const seasonLeader = jeanSeasonPts > edSeasonPts ? 'Jean' : edSeasonPts > jeanSeasonPts ? 'Ed' : 'Tied';

      return (
        <div className="min-h-screen bg-gradient-to-b from-teal-800 to-teal-900 p-4">
          <div className="max-w-md mx-auto">
            {/* Header */}
            <div className="text-center mb-6">
              <h1 className="text-2xl font-bold text-white mb-1">üè• Scrubs Prediction Game</h1>
              <p className="text-teal-200 text-sm">The Sacred Chart</p>
            </div>

            {/* Episode Selector */}
            <div className="bg-white/10 rounded-xl p-4 mb-4">
              <div className="flex items-center justify-center gap-4">
                <div className="text-center">
                  <label className="text-teal-200 text-xs block mb-1">Season</label>
                  <div className="flex items-center gap-2">
                    <button 
                      onClick={() => setCurrentSeason(Math.max(1, currentSeason - 1))}
                      className="w-8 h-8 bg-teal-600 text-white rounded-lg font-bold"
                    >-</button>
                    <span className="text-white text-xl font-bold w-8 text-center">{currentSeason}</span>
                    <button 
                      onClick={() => setCurrentSeason(Math.min(9, currentSeason + 1))}
                      className="w-8 h-8 bg-teal-600 text-white rounded-lg font-bold"
                    >+</button>
                  </div>
                </div>
                <div className="text-3xl text-teal-400">:</div>
                <div className="text-center">
                  <label className="text-teal-200 text-xs block mb-1">Episode</label>
                  <div className="flex items-center gap-2">
                    <button 
                      onClick={() => setCurrentEpisode(Math.max(1, currentEpisode - 1))}
                      className="w-8 h-8 bg-teal-600 text-white rounded-lg font-bold"
                    >-</button>
                    <span className="text-white text-xl font-bold w-8 text-center">{currentEpisode}</span>
                    <button 
                      onClick={() => setCurrentEpisode(currentEpisode + 1)}
                      className="w-8 h-8 bg-teal-600 text-white rounded-lg font-bold"
                    >+</button>
                  </div>
                </div>
              </div>
            </div>

            {/* Episode Scoreboard */}
            <div className="bg-white rounded-xl p-4 mb-4 shadow-lg">
              <div className="text-center text-xs text-gray-400 mb-2">S{currentSeason} E{currentEpisode}</div>
              <div className="flex justify-around items-center">
                <div className="text-center">
                  <div className="text-4xl font-bold text-teal-700">{jeanEpisodePts}</div>
                  <div className="text-lg font-semibold text-gray-700">Jean</div>
                </div>
                <div className="text-center">
                  <div className="text-xs px-3 py-1 bg-teal-100 text-teal-700 rounded-full font-medium">
                    {episodeLeader === 'Tied' ? 'ü§ù Tied!' : `üëë ${episodeLeader} leads`}
                  </div>
                </div>
                <div className="text-center">
                  <div className="text-4xl font-bold text-teal-700">{edEpisodePts}</div>
                  <div className="text-lg font-semibold text-gray-700">Ed</div>
                </div>
              </div>
            </div>

            {/* Prediction Buttons */}
            <div className="grid grid-cols-2 gap-4 mb-4">
              {/* Jean's predictions */}
              <div className="bg-white/10 rounded-xl p-3">
                <div className="text-white text-center font-semibold mb-2">Jean predicts...</div>
                <button
                  onClick={() => awardPoint('jean', true)}
                  className="w-full py-3 bg-green-500 hover:bg-green-600 text-white rounded-lg font-bold mb-2 transition-colors"
                >
                  ‚úì Correct!
                </button>
                <button
                  onClick={() => awardPoint('jean', false)}
                  className="w-full py-3 bg-red-400 hover:bg-red-500 text-white rounded-lg font-bold transition-colors"
                >
                  ‚úó Wrong
                </button>
              </div>

              {/* Ed's predictions */}
              <div className="bg-white/10 rounded-xl p-3">
                <div className="text-white text-center font-semibold mb-2">Ed predicts...</div>
                <button
                  onClick={() => awardPoint('ed', true)}
                  className="w-full py-3 bg-green-500 hover:bg-green-600 text-white rounded-lg font-bold mb-2 transition-colors"
                >
                  ‚úì Correct!
                </button>
                <button
                  onClick={() => awardPoint('ed', false)}
                  className="w-full py-3 bg-red-400 hover:bg-red-500 text-white rounded-lg font-bold transition-colors"
                >
                  ‚úó Wrong
                </button>
              </div>
            </div>

            {/* Leaderboard */}
            <div className="bg-white/10 rounded-xl p-4">
              <div className="flex justify-between items-center mb-3">
                <h2 className="text-white font-semibold">Leaderboard</h2>
                <button
                  onClick={resetGame}
                  className="text-xs text-teal-300 hover:text-white"
                >
                  Reset All
                </button>
              </div>
              {gameData.history.length === 0 ? (
                <p className="text-teal-200 text-sm text-center py-4">No predictions yet!</p>
              ) : (
                <div className="space-y-2 max-h-56 overflow-y-auto">
                  {[...new Set(gameData.history.map(h => h.season))].sort((a, b) => a - b).map(season => {
                    const seasonEntries = gameData.history.filter(h => h.season === season);
                    const jeanSeasonPts = seasonEntries.filter(h => h.winner === 'Jean').length;
                    const edSeasonPts = seasonEntries.filter(h => h.winner === 'Ed').length;
                    const seasonLeader = jeanSeasonPts > edSeasonPts ? 'üëë' : edSeasonPts > jeanSeasonPts ? 'üëë' : 'ü§ù';
                    return (
                      <div key={season} className="flex justify-between items-center text-sm bg-white/5 rounded-lg px-3 py-2">
                        <span className="text-teal-200 font-medium">Season {season}</span>
                        <div className="flex items-center gap-4">
                          <span className={`text-white ${jeanSeasonPts > edSeasonPts ? 'font-bold' : ''}`}>
                            {jeanSeasonPts > edSeasonPts && seasonLeader} Jean: {jeanSeasonPts}
                          </span>
                          <span className={`text-white ${edSeasonPts > jeanSeasonPts ? 'font-bold' : ''}`}>
                            Ed: {edSeasonPts} {edSeasonPts > jeanSeasonPts && seasonLeader}
                          </span>
                          {jeanSeasonPts === edSeasonPts && <span>{seasonLeader}</span>}
                        </div>
                      </div>
                    );
                  })}
                  {/* All-Time Tally */}
                  <div className="flex justify-between items-center text-sm bg-teal-600/40 rounded-lg px-3 py-2 mt-2 border border-teal-400/30">
                    <span className="text-white font-bold">All-Time</span>
                    <div className="flex items-center gap-4">
                      <span className={`text-white ${jeanPoints > edPoints ? 'font-bold' : ''}`}>
                        {jeanPoints > edPoints && 'üëë'} Jean: {jeanPoints}
                      </span>
                      <span className={`text-white ${edPoints > jeanPoints ? 'font-bold' : ''}`}>
                        Ed: {edPoints} {edPoints > jeanPoints && 'üëë'}
                      </span>
                      {jeanPoints === edPoints && <span>ü§ù</span>}
                    </div>
                  </div>
                </div>
              )}
            </div>

            {/* Footer */}
            <p className="text-center text-teal-300/50 text-xs mt-4">
              Tap the season/episode before making predictions
            </p>
          </div>
        </div>
      );
    }

    ReactDOM.createRoot(document.getElementById('root')).render(<PredictionGame />);
  </script>
</body>
</html>
