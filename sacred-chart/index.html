<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="Sacred Chart">
  <meta name="theme-color" content="#115e59">
  <title>Scrubs Prediction Game - The Sacred Chart</title>
  
  <link rel="apple-touch-icon" href="icon-192.png">
  <link rel="manifest" href="manifest.json">
  
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  
  <style>
    body {
      margin: 0;
      padding: 0;
      overscroll-behavior: none;
    }
  </style>
</head>
<body>
  <div id="root"></div>
  
  <script type="text/babel">
    const { useState, useEffect } = React;

    function PredictionGame() {
      const [gameData, setGameData] = useState(null);
      const [loading, setLoading] = useState(true);
      const [currentSeason, setCurrentSeason] = useState(1);
      const [currentEpisode, setCurrentEpisode] = useState(1);
      const [showSetup, setShowSetup] = useState(false);
      const [player1Name, setPlayer1Name] = useState('');
      const [player2Name, setPlayer2Name] = useState('');

      const createDefaultData = (p1Name, p2Name) => ({
        players: {
          player1: { name: p1Name, totalPoints: 0 },
          player2: { name: p2Name, totalPoints: 0 }
        },
        history: []
      });

      useEffect(() => {
        loadData();
      }, []);

      const loadData = () => {
        try {
          const saved = localStorage.getItem('sacred-chart-data');
          if (saved) {
            setGameData(JSON.parse(saved));
          } else {
            setShowSetup(true);
          }
        } catch (e) {
          setShowSetup(true);
        }
        setLoading(false);
      };

      const handleSetup = (e) => {
        e.preventDefault();
        if (player1Name.trim() && player2Name.trim()) {
          const newData = createDefaultData(player1Name.trim(), player2Name.trim());
          saveData(newData);
          setShowSetup(false);
        }
      };

      const saveData = (newData) => {
        setGameData(newData);
        try {
          localStorage.setItem('sacred-chart-data', JSON.stringify(newData));
        } catch (e) {
          console.error('Failed to save:', e);
        }
      };

      const awardPoint = (predictor, correct) => {
        const winner = correct ? predictor : (predictor === 'player1' ? 'player2' : 'player1');
        const newData = {
          ...gameData,
          players: {
            ...gameData.players,
            [winner]: {
              ...gameData.players[winner],
              totalPoints: gameData.players[winner].totalPoints + 1
            }
          },
          history: [
            {
              season: currentSeason,
              episode: currentEpisode,
              predictor: gameData.players[predictor].name,
              correct,
              winner: gameData.players[winner].name,
              timestamp: new Date().toISOString()
            },
            ...gameData.history
          ]
        };
        saveData(newData);
      };

      const resetGame = () => {
        if (confirm('Reset all scores and history?')) {
          const p1Name = gameData.players.player1.name;
          const p2Name = gameData.players.player2.name;
          saveData(createDefaultData(p1Name, p2Name));
          setCurrentSeason(1);
          setCurrentEpisode(1);
        }
      };

      if (loading) {
        return (
          <div className="min-h-screen bg-teal-900 flex items-center justify-center">
            <div className="text-white text-xl">Loading...</div>
          </div>
        );
      }

      if (showSetup || !gameData) {
        return (
          <div className="min-h-screen bg-gradient-to-b from-teal-800 to-teal-900 p-4 flex items-center justify-center">
            <div className="max-w-md w-full">
              <div className="text-center mb-8">
                <h1 className="text-2xl font-bold text-white mb-2">üè• Scrubs Prediction Game</h1>
                <p className="text-teal-200">The Sacred Chart</p>
              </div>
              <form onSubmit={handleSetup} className="bg-white/10 rounded-xl p-6">
                <h2 className="text-white text-lg font-semibold mb-4 text-center">Enter Player Names</h2>
                <div className="space-y-4">
                  <div>
                    <label className="text-teal-200 text-sm block mb-1">Player 1</label>
                    <input
                      type="text"
                      value={player1Name}
                      onChange={(e) => setPlayer1Name(e.target.value)}
                      className="w-full px-4 py-2 rounded-lg bg-white/20 text-white placeholder-teal-300 border border-teal-400/30 focus:outline-none focus:border-teal-300"
                      placeholder="Enter name..."
                      required
                    />
                  </div>
                  <div>
                    <label className="text-teal-200 text-sm block mb-1">Player 2</label>
                    <input
                      type="text"
                      value={player2Name}
                      onChange={(e) => setPlayer2Name(e.target.value)}
                      className="w-full px-4 py-2 rounded-lg bg-white/20 text-white placeholder-teal-300 border border-teal-400/30 focus:outline-none focus:border-teal-300"
                      placeholder="Enter name..."
                      required
                    />
                  </div>
                  <button
                    type="submit"
                    className="w-full py-3 bg-teal-500 hover:bg-teal-400 text-white rounded-lg font-bold transition-colors mt-4"
                  >
                    Start Game
                  </button>
                </div>
              </form>
            </div>
          </div>
        );
      }

      const p1Name = gameData.players.player1.name;
      const p2Name = gameData.players.player2.name;
      const p1Points = gameData.players.player1.totalPoints;
      const p2Points = gameData.players.player2.totalPoints;
      const leader = p1Points > p2Points ? p1Name : p2Points > p1Points ? p2Name : 'Tied';

      // Episode scores
      const episodeEntries = gameData.history.filter(h => h.season === currentSeason && h.episode === currentEpisode);
      const p1EpisodePts = episodeEntries.filter(h => h.winner === p1Name).length;
      const p2EpisodePts = episodeEntries.filter(h => h.winner === p2Name).length;
      const episodeLeader = p1EpisodePts > p2EpisodePts ? p1Name : p2EpisodePts > p1EpisodePts ? p2Name : 'Tied';

      // Season scores
      const seasonEntries = gameData.history.filter(h => h.season === currentSeason);
      const p1SeasonPts = seasonEntries.filter(h => h.winner === p1Name).length;
      const p2SeasonPts = seasonEntries.filter(h => h.winner === p2Name).length;
      const seasonLeader = p1SeasonPts > p2SeasonPts ? p1Name : p2SeasonPts > p1SeasonPts ? p2Name : 'Tied';

      return (
        <div className="min-h-screen bg-gradient-to-b from-teal-800 to-teal-900 p-4">
          <div className="max-w-md mx-auto">
            {/* Header */}
            <div className="text-center mb-6">
              <h1 className="text-2xl font-bold text-white mb-1">üè• Scrubs Prediction Game</h1>
              <p className="text-teal-200 text-sm">The Sacred Chart</p>
            </div>

            {/* Episode Selector */}
            <div className="bg-white/10 rounded-xl p-4 mb-4">
              <div className="flex items-center justify-center gap-4">
                <div className="text-center">
                  <label className="text-teal-200 text-xs block mb-1">Season</label>
                  <div className="flex items-center gap-2">
                    <button 
                      onClick={() => setCurrentSeason(Math.max(1, currentSeason - 1))}
                      className="w-8 h-8 bg-teal-600 text-white rounded-lg font-bold"
                    >-</button>
                    <span className="text-white text-xl font-bold w-8 text-center">{currentSeason}</span>
                    <button 
                      onClick={() => setCurrentSeason(Math.min(9, currentSeason + 1))}
                      className="w-8 h-8 bg-teal-600 text-white rounded-lg font-bold"
                    >+</button>
                  </div>
                </div>
                <div className="text-3xl text-teal-400">:</div>
                <div className="text-center">
                  <label className="text-teal-200 text-xs block mb-1">Episode</label>
                  <div className="flex items-center gap-2">
                    <button 
                      onClick={() => setCurrentEpisode(Math.max(1, currentEpisode - 1))}
                      className="w-8 h-8 bg-teal-600 text-white rounded-lg font-bold"
                    >-</button>
                    <span className="text-white text-xl font-bold w-8 text-center">{currentEpisode}</span>
                    <button 
                      onClick={() => setCurrentEpisode(currentEpisode + 1)}
                      className="w-8 h-8 bg-teal-600 text-white rounded-lg font-bold"
                    >+</button>
                  </div>
                </div>
              </div>
            </div>

            {/* Episode Scoreboard */}
            <div className="bg-white rounded-xl p-4 mb-4 shadow-lg">
              <div className="text-center text-xs text-gray-400 mb-2">S{currentSeason} E{currentEpisode}</div>
              <div className="flex justify-around items-center">
                <div className="text-center">
                  <div className="text-4xl font-bold text-teal-700">{p1EpisodePts}</div>
                  <div className="text-lg font-semibold text-gray-700">{p1Name}</div>
                </div>
                <div className="text-center">
                  <div className="text-xs px-3 py-1 bg-teal-100 text-teal-700 rounded-full font-medium">
                    {episodeLeader === 'Tied' ? 'ü§ù Tied!' : `üëë ${episodeLeader} leads`}
                  </div>
                </div>
                <div className="text-center">
                  <div className="text-4xl font-bold text-teal-700">{p2EpisodePts}</div>
                  <div className="text-lg font-semibold text-gray-700">{p2Name}</div>
                </div>
              </div>
            </div>

            {/* Prediction Buttons */}
            <div className="grid grid-cols-2 gap-4 mb-4">
              {/* Player 1's predictions */}
              <div className="bg-white/10 rounded-xl p-3">
                <div className="text-white text-center font-semibold mb-2">{p1Name} predicts...</div>
                <button
                  onClick={() => awardPoint('player1', true)}
                  className="w-full py-3 bg-green-500 hover:bg-green-600 text-white rounded-lg font-bold mb-2 transition-colors"
                >
                  ‚úì Correct!
                </button>
                <button
                  onClick={() => awardPoint('player1', false)}
                  className="w-full py-3 bg-red-400 hover:bg-red-500 text-white rounded-lg font-bold transition-colors"
                >
                  ‚úó Wrong
                </button>
              </div>

              {/* Player 2's predictions */}
              <div className="bg-white/10 rounded-xl p-3">
                <div className="text-white text-center font-semibold mb-2">{p2Name} predicts...</div>
                <button
                  onClick={() => awardPoint('player2', true)}
                  className="w-full py-3 bg-green-500 hover:bg-green-600 text-white rounded-lg font-bold mb-2 transition-colors"
                >
                  ‚úì Correct!
                </button>
                <button
                  onClick={() => awardPoint('player2', false)}
                  className="w-full py-3 bg-red-400 hover:bg-red-500 text-white rounded-lg font-bold transition-colors"
                >
                  ‚úó Wrong
                </button>
              </div>
            </div>

            {/* Leaderboard */}
            <div className="bg-white/10 rounded-xl p-4">
              <div className="flex justify-between items-center mb-3">
                <h2 className="text-white font-semibold">Leaderboard</h2>
                <button
                  onClick={resetGame}
                  className="text-xs text-teal-300 hover:text-white"
                >
                  Reset All
                </button>
              </div>
              {gameData.history.length === 0 ? (
                <p className="text-teal-200 text-sm text-center py-4">No predictions yet!</p>
              ) : (
                <div className="space-y-2 max-h-56 overflow-y-auto">
                  {[...new Set(gameData.history.map(h => h.season))].sort((a, b) => a - b).map(season => {
                    const seasonEntriesForLeaderboard = gameData.history.filter(h => h.season === season);
                    const p1SeasonPtsLB = seasonEntriesForLeaderboard.filter(h => h.winner === p1Name).length;
                    const p2SeasonPtsLB = seasonEntriesForLeaderboard.filter(h => h.winner === p2Name).length;
                    const seasonLeaderIcon = p1SeasonPtsLB > p2SeasonPtsLB ? 'üëë' : p2SeasonPtsLB > p1SeasonPtsLB ? 'üëë' : 'ü§ù';
                    return (
                      <div key={season} className="flex justify-between items-center text-sm bg-white/5 rounded-lg px-3 py-2">
                        <span className="text-teal-200 font-medium">Season {season}</span>
                        <div className="flex items-center gap-4">
                          <span className={`text-white ${p1SeasonPtsLB > p2SeasonPtsLB ? 'font-bold' : ''}`}>
                            {p1SeasonPtsLB > p2SeasonPtsLB && seasonLeaderIcon} {p1Name}: {p1SeasonPtsLB}
                          </span>
                          <span className={`text-white ${p2SeasonPtsLB > p1SeasonPtsLB ? 'font-bold' : ''}`}>
                            {p2Name}: {p2SeasonPtsLB} {p2SeasonPtsLB > p1SeasonPtsLB && seasonLeaderIcon}
                          </span>
                          {p1SeasonPtsLB === p2SeasonPtsLB && <span>{seasonLeaderIcon}</span>}
                        </div>
                      </div>
                    );
                  })}
                  {/* All-Time Tally */}
                  <div className="flex justify-between items-center text-sm bg-teal-600/40 rounded-lg px-3 py-2 mt-2 border border-teal-400/30">
                    <span className="text-white font-bold">All-Time</span>
                    <div className="flex items-center gap-4">
                      <span className={`text-white ${p1Points > p2Points ? 'font-bold' : ''}`}>
                        {p1Points > p2Points && 'üëë'} {p1Name}: {p1Points}
                      </span>
                      <span className={`text-white ${p2Points > p1Points ? 'font-bold' : ''}`}>
                        {p2Name}: {p2Points} {p2Points > p1Points && 'üëë'}
                      </span>
                      {p1Points === p2Points && <span>ü§ù</span>}
                    </div>
                  </div>
                </div>
              )}
            </div>

            {/* Footer */}
            <p className="text-center text-teal-300/50 text-xs mt-4">
              Tap the season/episode before making predictions
            </p>
          </div>
        </div>
      );
    }

    ReactDOM.createRoot(document.getElementById('root')).render(<PredictionGame />);
  </script>
</body>
</html>
